var li=Object.defineProperty;var si=(e,t,n)=>t in e?li(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var S=(e,t,n)=>si(e,typeof t!="symbol"?t+"":t,n);import{m as Bt,s as ai,d as ft,o as an,c as N,u as pt,a as w,S as D,b as pe,e as Ae,f as Z,t as C,g as ci,I as _t,i as m,h as y,M as Me,j as De,F as cn,k as dn,l as A,n as ie,p as di,q as ui,C as Ft,r as ot,v as hi,w as fi,x as pi,P as Ne,y as Vt,z as _i,A as Q,B as gi,D as Ut,E as et,G as vi,U as lt,H as mi}from"./index-D3fME4Ig.js";import{S as Zt,f as Te}from"./session_store-CjgTReIv.js";const bi=(e,t)=>{const n=new Map,i=e.ctx();for(const[r,o]of e.allDests(i))if(o.nonEmpty()){const l=Array.from(o,Bt);r===i.king&&ai(r)===4&&(o.has(0)?l.push("c1"):o.has(56)&&l.push("c8"),o.has(7)?l.push("g1"):o.has(63)&&l.push("g8")),n.set(Bt(r),l)}return n},wi=["white","black"],ze=["a","b","c","d","e","f","g","h"],We=["1","2","3","4","5","6","7","8"],yi=[...We].reverse(),gt=Array.prototype.concat(...ze.map(e=>We.map(t=>e+t))),V=e=>gt[8*e[0]+e[1]],M=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],un=gt.map(M);function $i(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const ki=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},vt=e=>e==="white"?"black":"white",qe=(e,t)=>{const n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},st=(e,t)=>e.role===t.role&&e.color===t.color,Ee=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],X=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},hn=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},mt=(e,t)=>{e.style.visibility=t?"visible":"hidden"},ve=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},fn=e=>e.button===2,ee=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function pn(e,t,n){const i=M(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}const ge=(e,t)=>Math.abs(e-t),Si=e=>(t,n,i,r)=>ge(t,i)<2&&(e==="white"?r===n+1||n<=1&&r===n+2&&t===i:r===n-1||n>=6&&r===n-2&&t===i),_n=(e,t,n,i)=>{const r=ge(e,n),o=ge(t,i);return r===1&&o===2||r===2&&o===1},gn=(e,t,n,i)=>ge(e,n)===ge(t,i),vn=(e,t,n,i)=>e===n||t===i,mn=(e,t,n,i)=>gn(e,t,n,i)||vn(e,t,n,i),Ci=(e,t,n)=>(i,r,o,l)=>ge(i,o)<2&&ge(r,l)<2||n&&r===l&&r===(e==="white"?0:7)&&(i===4&&(o===2&&t.includes(0)||o===6&&t.includes(7))||t.includes(o));function Pi(e,t){const n=t==="white"?"1":"8",i=[];for(const[r,o]of e)r[1]===n&&o.color===t&&o.role==="rook"&&i.push(M(r)[0]);return i}function bn(e,t,n){const i=e.get(t);if(!i)return[];const r=M(t),o=i.role,l=o==="pawn"?Si(i.color):o==="knight"?_n:o==="bishop"?gn:o==="rook"?vn:o==="queen"?mn:Ci(i.color,Pi(e,i.color),n);return un.filter(s=>(r[0]!==s[0]||r[1]!==s[1])&&l(r[0],r[1],s[0],s[1])).map(V)}function W(e,...t){e&&setTimeout(()=>e(...t),1)}function xi(e){e.orientation=vt(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Mi(e,t){for(const[n,i]of t)i?e.pieces.set(n,i):e.pieces.delete(n)}function zi(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,i]of e.pieces)i.role==="king"&&i.color===t&&(e.check=n)}function qi(e,t,n,i){oe(e),e.premovable.current=[t,n],W(e.premovable.events.set,t,n,i)}function re(e){e.premovable.current&&(e.premovable.current=void 0,W(e.premovable.events.unset))}function Ei(e,t,n){re(e),e.predroppable.current={role:t,key:n},W(e.predroppable.events.set,t,n)}function oe(e){const t=e.predroppable;t.current&&(t.current=void 0,W(t.events.unset))}function ji(e,t,n){if(!e.autoCastle)return!1;const i=e.pieces.get(t);if(!i||i.role!=="king")return!1;const r=M(t),o=M(n);if(r[1]!==0&&r[1]!==7||r[1]!==o[1])return!1;r[0]===4&&!e.pieces.has(n)&&(o[0]===6?n=V([7,o[1]]):o[0]===2&&(n=V([0,o[1]])));const l=e.pieces.get(n);return!l||l.color!==i.color||l.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),r[0]<o[0]?(e.pieces.set(V([6,o[1]]),i),e.pieces.set(V([5,o[1]]),l)):(e.pieces.set(V([2,o[1]]),i),e.pieces.set(V([3,o[1]]),l)),!0)}function wn(e,t,n){const i=e.pieces.get(t),r=e.pieces.get(n);if(t===n||!i)return!1;const o=r&&r.color!==i.color?r:void 0;return n===e.selected&&U(e),W(e.events.move,t,n,o),ji(e,t,n)||(e.pieces.set(n,i),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,W(e.events.change),o||!0}function bt(e,t,n,i){if(e.pieces.has(n))if(i)e.pieces.delete(n);else return!1;return W(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,W(e.events.change),e.movable.dests=void 0,e.turnColor=vt(e.turnColor),!0}function yn(e,t,n){const i=wn(e,t,n);return i&&(e.movable.dests=void 0,e.turnColor=vt(e.turnColor),e.animation.current=void 0),i}function $n(e,t,n){if(wt(e,t,n)){const i=yn(e,t,n);if(i){const r=e.hold.stop();U(e);const o={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return i!==!0&&(o.captured=i),W(e.movable.events.after,t,n,o),!0}}else if(Di(e,t,n))return qi(e,t,n,{ctrlKey:e.stats.ctrlKey}),U(e),!0;return U(e),!1}function kn(e,t,n,i){const r=e.pieces.get(t);r&&(Ai(e,t,n)||i)?(e.pieces.delete(t),bt(e,r,n,i),W(e.movable.events.afterNewPiece,r.role,n,{premove:!1,predrop:!1})):r&&Ti(e,t,n)?Ei(e,r.role,n):(re(e),oe(e)),e.pieces.delete(t),U(e)}function at(e,t,n){if(W(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){U(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&$n(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Cn(e,t)||yt(e,t))&&(Sn(e,t),e.hold.start())}function Sn(e,t){e.selected=t,yt(e,t)?e.premovable.customDests||(e.premovable.dests=bn(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function U(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Cn(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const wt=(e,t,n)=>{var i,r;return t!==n&&Cn(e,t)&&(e.movable.free||!!(!((r=(i=e.movable.dests)===null||i===void 0?void 0:i.get(t))===null||r===void 0)&&r.includes(n)))};function Ai(e,t,n){const i=e.pieces.get(t);return!!i&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function yt(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Di(e,t,n){var i,r;const o=(r=(i=e.premovable.customDests)===null||i===void 0?void 0:i.get(t))!==null&&r!==void 0?r:bn(e.pieces,t,e.premovable.castle);return t!==n&&yt(e,t)&&o.includes(n)}function Ti(e,t,n){const i=e.pieces.get(t),r=e.pieces.get(n);return!!i&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function Oi(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Ni(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],i=t[1];let r=!1;if(wt(e,n,i)){const o=yn(e,n,i);if(o){const l={premove:!0};o!==!0&&(l.captured=o),W(e.movable.events.after,n,i,l),r=!0}}return re(e),r}function Wi(e,t){const n=e.predroppable.current;let i=!1;if(!n)return!1;if(t(n)){const r={role:n.role,color:e.movable.color};bt(e,r,n.key)&&(W(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return oe(e),i}function $t(e){re(e),oe(e),U(e)}function Gt(e){e.movable.color=e.movable.dests=e.animation.current=void 0,$t(e)}function me(e,t,n){let i=Math.floor(8*(e[0]-n.left)/n.width);t||(i=7-i);let r=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(r=7-r),i>=0&&i<8&&r>=0&&r<8?V([i,r]):void 0}function Li(e,t,n,i){const r=M(e),o=un.filter(a=>mn(r[0],r[1],a[0],a[1])||_n(r[0],r[1],a[0],a[1])),s=o.map(a=>pn(V(a),n,i)).map(a=>qe(t,a)),[,d]=s.reduce((a,f,c)=>a[0]<f?a:[f,c],[s[0],0]);return V(o[d])}const L=e=>e.orientation==="white",Pn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Ri={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Ki={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function xn(e){e==="start"&&(e=Pn);const t=new Map;let n=7,i=0;for(const r of e)switch(r){case" ":case"[":return t;case"/":if(--n,n<0)return t;i=0;break;case"~":{const o=t.get(V([i-1,n]));o&&(o.promoted=!0);break}default:{const o=r.charCodeAt(0);if(o<57)i+=o-48;else{const l=r.toLowerCase();t.set(V([i,n]),{role:Ri[l],color:r===l?"black":"white"}),++i}}}return t}function Hi(e){return yi.map(t=>ze.map(n=>{const i=e.get(n+t);if(i){let r=Ki[i.role];return i.color==="white"&&(r=r.toUpperCase()),i.promoted&&(r+="~"),r}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Mn(e,t){t.animation&&(kt(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function zn(e,t){var n,i,r;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((i=t.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),kt(e,t),t.fen&&(e.pieces=xn(t.fen),e.drawable.shapes=((r=t.drawable)===null||r===void 0?void 0:r.shapes)||[]),"check"in t&&zi(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&Sn(e,e.selected),Mn(e,t),!e.movable.rookCastle&&e.movable.dests){const o=e.movable.color==="white"?"1":"8",l="e"+o,s=e.movable.dests.get(l),d=e.pieces.get(l);if(!s||!d||d.role!=="king")return;e.movable.dests.set(l,s.filter(a=>!(a==="a"+o&&s.includes("c"+o))&&!(a==="h"+o&&s.includes("g"+o))))}}function kt(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&Xt(e[n])&&Xt(t[n])?kt(e[n],t[n]):e[n]=t[n])}function Xt(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const fe=(e,t)=>t.animation.enabled?Fi(e,t):ne(e,t);function ne(e,t){const n=e(t);return t.dom.redraw(),n}const tt=(e,t)=>({key:e,pos:M(e),piece:t}),Ii=(e,t)=>t.sort((n,i)=>qe(e.pos,n.pos)-qe(e.pos,i.pos))[0];function Bi(e,t){const n=new Map,i=[],r=new Map,o=[],l=[],s=new Map;let d,a,f;for(const[c,h]of e)s.set(c,tt(c,h));for(const c of gt)d=t.pieces.get(c),a=s.get(c),d?a?st(d,a.piece)||(o.push(a),l.push(tt(c,d))):l.push(tt(c,d)):a&&o.push(a);for(const c of l)a=Ii(c,o.filter(h=>st(c.piece,h.piece))),a&&(f=[a.pos[0]-c.pos[0],a.pos[1]-c.pos[1]],n.set(c.key,f.concat(f)),i.push(a.key));for(const c of o)i.includes(c.key)||r.set(c.key,c.piece);return{anims:n,fadings:r}}function qn(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(t-n.start)*n.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const r=Vi(i);for(const o of n.plan.anims.values())o[2]=o[0]*r,o[3]=o[1]*r;e.dom.redrawNow(!0),requestAnimationFrame((o=performance.now())=>qn(e,o))}}function Fi(e,t){const n=new Map(t.pieces),i=e(t),r=Bi(n,t);if(r.anims.size||r.fadings.size){const o=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:r},o||qn(t,performance.now())}else t.dom.redraw();return i}const Vi=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Ui=["green","red","blue","yellow"];function Zi(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?U(e):$t(e);const n=ve(t),i=me(n,L(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:n,brush:Qi(t),snapToValidMove:e.drawable.defaultSnapToValidMove},En(e))}function En(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=me(t.pos,L(e),e.dom.bounds());n||(t.snapToValidMove=!1);const i=t.snapToValidMove?Li(t.orig,t.pos,L(e),e.dom.bounds()):n;i!==t.mouseSq&&(t.mouseSq=i,t.dest=i!==t.orig?i:void 0,e.dom.redrawNow()),En(e)}})}function Gi(e,t){e.drawable.current&&(e.drawable.current.pos=ve(t))}function Xi(e){const t=e.drawable.current;t&&(t.mouseSq&&Ji(e.drawable,t),jn(e))}function jn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Yi(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),An(e.drawable))}function Qi(e){var t;const n=(e.shiftKey||e.ctrlKey)&&fn(e),i=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return Ui[(n?1:0)+(i?2:0)]}function Ji(e,t){const n=r=>r.orig===t.orig&&r.dest===t.dest,i=e.shapes.find(n);i&&(e.shapes=e.shapes.filter(r=>!n(r))),(!i||i.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),An(e)}function An(e){e.onChange&&e.onChange(e.shapes)}function er(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),i=ve(t),r=me(i,L(e),n);if(!r)return;const o=e.pieces.get(r),l=e.selected;if(!l&&e.drawable.enabled&&(e.drawable.eraseOnClick||!o||o.color!==e.turnColor)&&Yi(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||o||l||tr(e,i)))t.preventDefault();else if(t.touches)return;const s=!!e.premovable.current,d=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&wt(e,e.selected,r)?fe(c=>at(c,r),e):at(e,r);const a=e.selected===r,f=Tn(e,r);if(o&&f&&a&&Oi(e,r)){e.draggable.current={orig:r,piece:o,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:f,previouslySelected:l,originTarget:t.target,keyHasChanged:!1},f.cgDragging=!0,f.classList.add("dragging");const c=e.dom.elements.ghost;c&&(c.className=`ghost ${o.color} ${o.role}`,X(c,Ee(n)(M(r),L(e))),mt(c,!0)),St(e)}else s&&re(e),d&&oe(e);e.dom.redraw()}function tr(e,t){const n=L(e),i=e.dom.bounds(),r=Math.pow(i.width/8,2);for(const o of e.pieces.keys()){const l=pn(o,n,i);if(qe(l,t)<=r)return!0}return!1}function nr(e,t,n,i){const r="a0";e.pieces.set(r,t),e.dom.redraw();const o=ve(n);e.draggable.current={orig:r,piece:t,origPos:o,pos:o,started:!0,element:()=>Tn(e,r),originTarget:n.target,newPiece:!0,force:!!i,keyHasChanged:!1},St(e)}function St(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const i=e.pieces.get(n.orig);if(!i||!st(i,n.piece))Le(e);else if(!n.started&&qe(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const o=n.element();if(!o)return;o.cgDragging=!0,o.classList.add("dragging"),n.element=o}const r=e.dom.bounds();X(n.element,[n.pos[0]-r.left-r.width/16,n.pos[1]-r.top-r.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==me(n.pos,L(e),r))}St(e)})}function ir(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=ve(t))}function rr(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}re(e),oe(e);const i=ve(t)||n.pos,r=me(i,L(e),e.dom.bounds());r&&n.started&&n.orig!==r?n.newPiece?kn(e,n.orig,r,n.force):(e.stats.ctrlKey=t.ctrlKey,$n(e,n.orig,r)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(n.orig),W(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===r||!r)?U(e):e.selectable.enabled||U(e),Dn(e),e.draggable.current=void 0,e.dom.redraw()}function Le(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,U(e),Dn(e),e.dom.redraw())}function Dn(e){const t=e.dom.elements;t.ghost&&mt(t.ghost,!1)}function Tn(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function or(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{Yt(e,2),setTimeout(()=>Yt(e,void 0),120)},120)}function Yt(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function lr(e,t){function n(){xi(e),t()}return{set(i){i.orientation&&i.orientation!==e.orientation&&n(),Mn(e,i),(i.fen?fe:ne)(r=>zn(r,i),e)},state:e,getFen:()=>Hi(e.pieces),toggleOrientation:n,setPieces(i){fe(r=>Mi(r,i),e)},selectSquare(i,r){i?fe(o=>at(o,i,r),e):e.selected&&(U(e),e.dom.redraw())},move(i,r){fe(o=>wn(o,i,r),e)},newPiece(i,r){fe(o=>bt(o,i,r),e)},playPremove(){if(e.premovable.current){if(fe(Ni,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const r=Wi(e,i);return e.dom.redraw(),r}return!1},cancelPremove(){ne(re,e)},cancelPredrop(){ne(oe,e)},cancelMove(){ne(i=>{$t(i),Le(i)},e)},stop(){ne(i=>{Gt(i),Le(i)},e)},explode(i){or(e,i)},setAutoShapes(i){ne(r=>r.drawable.autoShapes=i,e)},setShapes(i){ne(r=>r.drawable.shapes=i,e)},getKeyAtDomPos(i){return me(i,L(e),e.dom.bounds())},redrawAll:t,dragNewPiece(i,r,o){nr(e,i,r,o)},destroy(){Gt(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function sr(){return{pieces:xn(Pn),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:ki()}}const Qt={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function ar(){const e=j("defs"),t=T(j("filter"),{id:"cg-filter-blur"});return t.appendChild(T(j("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function cr(e,t,n){var i;const r=e.drawable,o=r.current,l=o&&o.mouseSq?o:void 0,s=new Map,d=e.dom.bounds(),a=r.autoShapes.filter(g=>!g.piece);for(const g of r.shapes.concat(a).concat(l?[l]:[])){if(!g.dest)continue;const b=(i=s.get(g.dest))!==null&&i!==void 0?i:new Set,_=He(Ke(M(g.orig),e.orientation),d),q=He(Ke(M(g.dest),e.orientation),d);b.add(dt(_,q)),s.set(g.dest,b)}const f=r.shapes.concat(a).map(g=>({shape:g,current:!1,hash:Jt(g,ct(g.dest,s),!1,d)}));l&&f.push({shape:l,current:!0,hash:Jt(l,ct(l.dest,s),!0,d)});const c=f.map(g=>g.hash).join(";");if(c===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=c;const h=t.querySelector("defs");dr(r,f,h),ur(f,t.querySelector("g"),n.querySelector("g"),g=>pr(e,g,r.brushes,s,d))}function dr(e,t,n){var i;const r=new Map;let o;for(const d of t.filter(a=>a.shape.dest&&a.shape.brush))o=On(e.brushes[d.shape.brush],d.shape.modifiers),!((i=d.shape.modifiers)===null||i===void 0)&&i.hilite&&r.set(Re(o).key,Re(o)),r.set(o.key,o);const l=new Set;let s=n.firstElementChild;for(;s;)l.add(s.getAttribute("cgKey")),s=s.nextElementSibling;for(const[d,a]of r.entries())l.has(d)||n.appendChild(vr(a))}function ur(e,t,n,i){const r=new Map;for(const o of e)r.set(o.hash,!1);for(const o of[t,n]){const l=[];let s=o.firstElementChild,d;for(;s;)d=s.getAttribute("cgHash"),r.has(d)?r.set(d,!0):l.push(s),s=s.nextElementSibling;for(const a of l)o.removeChild(a)}for(const o of e.filter(l=>!r.get(l.hash)))for(const l of i(o))l.isCustom?n.appendChild(l.el):t.appendChild(l.el)}function Jt({orig:e,dest:t,brush:n,piece:i,modifiers:r,customSvg:o,label:l},s,d,a){var f,c;return[a.width,a.height,d,e,t,n,s&&"-",i&&hr(i),r&&fr(r),o&&`custom-${en(o.html)},${(c=(f=o.center)===null||f===void 0?void 0:f[0])!==null&&c!==void 0?c:"o"}`,l&&`label-${en(l.text)}`].filter(h=>h).join(",")}function hr(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function fr(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function en(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function pr(e,{shape:t,current:n,hash:i},r,o,l){var s,d;const a=He(Ke(M(t.orig),e.orientation),l),f=t.dest?He(Ke(M(t.dest),e.orientation),l):a,c=t.brush&&On(r[t.brush],t.modifiers),h=o.get(t.dest),g=[];if(c){const b=T(j("g"),{cgHash:i});g.push({el:b}),a[0]!==f[0]||a[1]!==f[1]?b.appendChild(gr(t,c,a,f,n,ct(t.dest,o))):b.appendChild(_r(r[t.brush],a,n,l))}if(t.label){const b=t.label;(s=b.fill)!==null&&s!==void 0||(b.fill=t.brush&&r[t.brush].color);const _=t.brush?void 0:"tr";g.push({el:mr(b,i,a,f,h,_),isCustom:!0})}if(t.customSvg){const b=(d=t.customSvg.center)!==null&&d!==void 0?d:"orig",[_,q]=b==="label"?Wn(a,f,h).map(E=>E-.5):b==="dest"?f:a,z=T(j("g"),{transform:`translate(${_},${q})`,cgHash:i});z.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,g.push({el:z,isCustom:!0})}return g}function _r(e,t,n,i){const r=br(),o=(i.width+i.height)/(4*Math.max(i.width,i.height));return T(j("circle"),{stroke:e.color,"stroke-width":r[n?0:1],fill:"none",opacity:Nn(e,n),cx:t[0],cy:t[1],r:o-r[1]/2})}function Re(e){return["#ffffff","#fff","white"].includes(e.color)?Qt.hilitePrimary:Qt.hiliteWhite}function gr(e,t,n,i,r,o){var l;function s(f){var c;const h=yr(o&&!r),g=i[0]-n[0],b=i[1]-n[1],_=Math.atan2(b,g),q=Math.cos(_)*h,z=Math.sin(_)*h;return T(j("line"),{stroke:f?Re(t).color:t.color,"stroke-width":wr(t,r)+(f?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${f?Re(t).key:t.key})`,opacity:!((c=e.modifiers)===null||c===void 0)&&c.hilite?1:Nn(t,r),x1:n[0],y1:n[1],x2:i[0]-q,y2:i[1]-z})}if(!(!((l=e.modifiers)===null||l===void 0)&&l.hilite))return s(!1);const d=j("g"),a=T(j("g"),{filter:"url(#cg-filter-blur)"});return a.appendChild($r(n,i)),a.appendChild(s(!0)),d.appendChild(a),d.appendChild(s(!1)),d}function vr(e){const t=T(j("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(T(j("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function mr(e,t,n,i,r,o){var l;const d=.4*.75**e.text.length,a=Wn(n,i,r),f=o==="tr"?.4:0,c=T(j("g"),{transform:`translate(${a[0]+f},${a[1]-f})`,cgHash:t});c.appendChild(T(j("circle"),{r:.4/2,"fill-opacity":o?1:.8,"stroke-opacity":o?1:.7,"stroke-width":.03,fill:(l=e.fill)!==null&&l!==void 0?l:"#666",stroke:"white"}));const h=T(j("text"),{"font-size":d,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return h.innerHTML=e.text,c.appendChild(h),c}function Ke(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function ct(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function j(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function T(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function On(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}:e}function br(){return[3/64,4/64]}function wr(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Nn(e,t){return(e.opacity||1)*(t?.9:1)}function yr(e){return(e?20:10)/64}function He(e,t){const n=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*i]}function $r(e,t){const n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return T(j("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function dt(e,t,n=!0){const i=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(i*8/Math.PI)+16)%16:i}function kr(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((n,i)=>n+i*i,0))}function Wn(e,t,n){let i=kr(e,t);const r=dt(e,t,!1);if(n&&(i-=33/64,n.size>1)){i-=10/64;const o=dt(e,t);(n.has((o+1)%16)||n.has((o+15)%16))&&o&1&&(i-=.4)}return[e[0]-Math.cos(r)*i,e[1]-Math.sin(r)*i].map(o=>o+.5)}function Sr(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const d of wi)e.classList.toggle("orientation-"+d,t.orientation===d);e.classList.toggle("manipulable",!t.viewOnly);const n=ee("cg-container");e.appendChild(n);const i=ee("cg-board");n.appendChild(i);let r,o,l;if(t.drawable.visible&&(r=T(j("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(ar()),r.appendChild(j("g")),o=T(j("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(j("g")),l=ee("cg-auto-pieces"),n.appendChild(r),n.appendChild(o),n.appendChild(l)),t.coordinates){const d=t.orientation==="black"?" black":"",a=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const f=t.orientation==="white"?c=>c+1:c=>8-c;ze.forEach((c,h)=>n.appendChild(nt(We.map(g=>c+g),"squares rank"+f(h)+d+a)))}else n.appendChild(nt(We,"ranks"+d+a)),n.appendChild(nt(ze,"files"+d))}let s;return t.draggable.enabled&&t.draggable.showGhost&&(s=ee("piece","ghost"),mt(s,!1),n.appendChild(s)),{board:i,container:n,wrap:e,ghost:s,svg:r,customSvg:o,autoPieces:l}}function nt(e,t){const n=ee("coords",t);let i;for(const r of e)i=ee("coord"),i.textContent=r,n.appendChild(i);return n}function Cr(e,t){if(!e.dropmode.active)return;re(e),oe(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const i=ve(t),r=i&&me(i,L(e),e.dom.bounds());r&&kn(e,"a0",r)}e.dom.redraw()}function Pr(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",r=>r.preventDefault()),e.viewOnly)return;const i=Mr(e);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1})}function xr(e,t){const n=[];if("ResizeObserver"in window||n.push(Pe(document.body,"chessground.resize",t)),!e.viewOnly){const i=tn(e,ir,Gi),r=tn(e,rr,Xi);for(const l of["touchmove","mousemove"])n.push(Pe(document,l,i));for(const l of["touchend","mouseup"])n.push(Pe(document,l,r));const o=()=>e.dom.bounds.clear();n.push(Pe(document,"scroll",o,{capture:!0,passive:!0})),n.push(Pe(window,"resize",o,{passive:!0}))}return()=>n.forEach(i=>i())}function Pe(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}const Mr=e=>t=>{e.draggable.current?Le(e):e.drawable.current?jn(e):t.shiftKey||fn(t)?e.drawable.enabled&&Zi(e,t):e.viewOnly||(e.dropmode.active?Cr(e,t):er(e,t))},tn=(e,t,n)=>i=>{e.drawable.current?e.drawable.enabled&&n(e,i):e.viewOnly||t(e,i)};function zr(e){const t=L(e),n=Ee(e.dom.bounds()),i=e.dom.elements.board,r=e.pieces,o=e.animation.current,l=o?o.plan.anims:new Map,s=o?o.plan.fadings:new Map,d=e.draggable.current,a=Er(e),f=new Set,c=new Set,h=new Map,g=new Map;let b,_,q,z,E,R,Y,B,le,be;for(_=i.firstChild;_;){if(b=_.cgKey,Ln(_))if(q=r.get(b),E=l.get(b),R=s.get(b),z=_.cgPiece,_.cgDragging&&(!d||d.orig!==b)&&(_.classList.remove("dragging"),X(_,n(M(b),t)),_.cgDragging=!1),!R&&_.cgFading&&(_.cgFading=!1,_.classList.remove("fading")),q){if(E&&_.cgAnimating&&z===xe(q)){const k=M(b);k[0]+=E[2],k[1]+=E[3],_.classList.add("anim"),X(_,n(k,t))}else _.cgAnimating&&(_.cgAnimating=!1,_.classList.remove("anim"),X(_,n(M(b),t)),e.addPieceZIndex&&(_.style.zIndex=it(M(b),t)));z===xe(q)&&(!R||!_.cgFading)?f.add(b):R&&z===xe(R)?(_.classList.add("fading"),_.cgFading=!0):rt(h,z,_)}else rt(h,z,_);else if(Rn(_)){const k=_.className;a.get(b)===k?c.add(b):rt(g,k,_)}_=_.nextSibling}for(const[k,G]of a)if(!c.has(k)){le=g.get(G),be=le&&le.pop();const K=n(M(k),t);if(be)be.cgKey=k,X(be,K);else{const H=ee("square",G);H.cgKey=k,X(H,K),i.insertBefore(H,i.firstChild)}}for(const[k,G]of r)if(E=l.get(k),!f.has(k))if(Y=h.get(xe(G)),B=Y&&Y.pop(),B){B.cgKey=k,B.cgFading&&(B.classList.remove("fading"),B.cgFading=!1);const K=M(k);e.addPieceZIndex&&(B.style.zIndex=it(K,t)),E&&(B.cgAnimating=!0,B.classList.add("anim"),K[0]+=E[2],K[1]+=E[3]),X(B,n(K,t))}else{const K=xe(G),H=ee("piece",K),se=M(k);H.cgPiece=K,H.cgKey=k,E&&(H.cgAnimating=!0,se[0]+=E[2],se[1]+=E[3]),X(H,n(se,t)),e.addPieceZIndex&&(H.style.zIndex=it(se,t)),i.appendChild(H)}for(const k of h.values())rn(e,k);for(const k of g.values())rn(e,k)}function qr(e){const t=L(e),n=Ee(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(Ln(i)&&!i.cgAnimating||Rn(i))&&X(i,n(M(i.cgKey),t)),i=i.nextSibling}function nn(e){var t,n;const i=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,o=i.height/i.width,l=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,s=l*o;r.style.width=l+"px",r.style.height=s+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",l+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-height",s+"px")}const Ln=e=>e.tagName==="PIECE",Rn=e=>e.tagName==="SQUARE";function rn(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function it(e,t){const i=e[1];return`${t?10-i:3+i}`}const xe=e=>`${e.color} ${e.role}`;function Er(e){var t,n,i;const r=new Map;if(e.lastMove&&e.highlight.lastMove)for(const s of e.lastMove)J(r,s,"last-move");if(e.check&&e.highlight.check&&J(r,e.check,"check"),e.selected&&(J(r,e.selected,"selected"),e.movable.showDests)){const s=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(s)for(const a of s)J(r,a,"move-dest"+(e.pieces.has(a)?" oc":""));const d=(i=(n=e.premovable.customDests)===null||n===void 0?void 0:n.get(e.selected))!==null&&i!==void 0?i:e.premovable.dests;if(d)for(const a of d)J(r,a,"premove-dest"+(e.pieces.has(a)?" oc":""))}const o=e.premovable.current;if(o)for(const s of o)J(r,s,"current-premove");else e.predroppable.current&&J(r,e.predroppable.current.key,"current-premove");const l=e.exploding;if(l)for(const s of l.keys)J(r,s,"exploding"+l.stage);return e.highlight.custom&&e.highlight.custom.forEach((s,d)=>{J(r,d,s)}),r}function J(e,t,n){const i=e.get(t);i?e.set(t,`${i} ${n}`):e.set(t,n)}function rt(e,t,n){const i=e.get(t);i?i.push(n):e.set(t,[n])}function jr(e,t,n){const i=new Map,r=[];for(const s of e)i.set(s.hash,!1);let o=t.firstElementChild,l;for(;o;)l=o.getAttribute("cgHash"),i.has(l)?i.set(l,!0):r.push(o),o=o.nextElementSibling;for(const s of r)t.removeChild(s);for(const s of e)i.get(s.hash)||t.appendChild(n(s))}function Ar(e,t){const i=e.drawable.autoShapes.filter(r=>r.piece).map(r=>({shape:r,hash:Or(r),current:!1}));jr(i,t,r=>Tr(e,r,e.dom.bounds()))}function Dr(e){var t;const n=L(e),i=Ee(e.dom.bounds());let r=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;r;)hn(r,i(M(r.cgKey),n),r.cgScale),r=r.nextSibling}function Tr(e,{shape:t,hash:n},i){var r,o,l;const s=t.orig,d=(r=t.piece)===null||r===void 0?void 0:r.role,a=(o=t.piece)===null||o===void 0?void 0:o.color,f=(l=t.piece)===null||l===void 0?void 0:l.scale,c=ee("piece",`${d} ${a}`);return c.setAttribute("cgHash",n),c.cgKey=s,c.cgScale=f,hn(c,Ee(i)(M(s),L(e)),f),c}const Or=e=>{var t,n,i;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")};function Nr(e,t){const n=sr();zn(n,t||{});function i(){const r="dom"in n?n.dom.unbind:void 0,o=Sr(e,n),l=$i(()=>o.board.getBoundingClientRect()),s=f=>{zr(a),o.autoPieces&&Ar(a,o.autoPieces),!f&&o.svg&&cr(a,o.svg,o.customSvg)},d=()=>{nn(a),qr(a),o.autoPieces&&Dr(a)},a=n;return a.dom={elements:o,bounds:l,redraw:Wr(s),redrawNow:s,unbind:r},a.drawable.prevSvgHash="",nn(a),s(!1),Pr(a,d),r||(a.dom.unbind=xr(a,d)),a.events.insert&&a.events.insert(o),a}return lr(i(),i)}function Wr(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}var Lr=C('<div class="is2d chessboard">'),Rr=C('<div id=promotion-choice class="is2d top"><square><piece></piece></square><square><piece></piece></square><square><piece></piece></square><square><piece>');const Kr=(e,t)=>{let[n,i]=ci(100,"zoom");document.body.style.setProperty("--zoom",n().toString());const r=document.createElement("cg-resize");e.container.appendChild(r);const o=s=>{s.preventDefault();const d=s.type==="touchstart"?"touchmove":"mousemove",a=s.type==="touchstart"?"touchend":"mouseup",f=on(s),c=parseInt(window.getComputedStyle(document.body).getPropertyValue("--zoom"));let h=c;const g=()=>{i(h)},b=_=>{const q=on(_),z=q[0]-f[0]+q[1]-f[1];h=Math.round(Math.min(100,Math.max(0,c+z/10))),document.body.style.setProperty("--zoom",h.toString()),g()};document.body.classList.add("resizing"),document.addEventListener(d,b),document.addEventListener(a,()=>{document.removeEventListener(d,b),document.body.classList.remove("resizing")},{once:!0})};r.addEventListener("touchstart",o,{passive:!1}),r.addEventListener("mousedown",o,{passive:!1});const l=s=>r.classList.toggle("none",!s);N(()=>{l(t())})};function on(e){var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if((t=e.targetTouches)!=null&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]}const Hr=e=>{let t,n;return an(()=>{let i=e.color,r=e.dests,o={events:{insert(l){Kr(l,()=>e.resizable||!1)}},premovable:{enabled:!1},movable:{color:i,free:!1,dests:r,events:{after:e.onMoveAfter}}};n=Nr(t,o)}),N(()=>{let i,r;e.fen_uci?[i,r]=e.fen_uci:i=_t;let o=[];r&&(o.push(r.slice(0,2)),o.push(r.slice(2,4)));let l=e.movable?e.color:void 0;n.set({fen:i,lastMove:o,turnColor:e.color,movable:{color:l,dests:e.dests}})}),N(()=>{let i=e.orientation??"white";n.set({orientation:i})}),N(()=>{let i=e.doPromotion;if(i){let[r,o]=i,l=n.state.pieces.get(r);n.setPieces(new Map([[r,{color:l.color,role:o,promoted:!0}]]))}}),[(()=>{var i=Lr();return pt(r=>t=r,i),i})(),w(D,{get when(){return e.pendingPromotion},children:i=>w(Ir,{get orientation(){return e.orientation??"white"},get endPendingPromotion(){return e.endPendingPromotion},get color(){return i().color},get dest(){return i().dest}})})]},Ir=e=>{let t=ze.indexOf(e.dest[0]);return e.orientation==="black"&&(t=7-t),t*=12.5,(()=>{var n=Rr(),i=n.firstChild,r=i.firstChild,o=i.nextSibling,l=o.firstChild,s=o.nextSibling,d=s.firstChild,a=s.nextSibling,f=a.firstChild;return n.$$click=()=>e.endPendingPromotion(void 0),i.$$click=()=>e.endPendingPromotion("q"),o.$$click=()=>e.endPendingPromotion("r"),s.$$click=()=>e.endPendingPromotion("n"),a.$$click=()=>e.endPendingPromotion("b"),pe(c=>{var h=`top: 0%; left: ${t}%`,g=`queen ${e.color}`,b=`top: 12.5%; left: ${t}%`,_=`rook ${e.color}`,q=`top: 25%; left: ${t}%`,z=`knight ${e.color}`,E=`top: 37.5%; left: ${t}%`,R=`bishop ${e.color}`;return c.e=Ae(i,h,c.e),g!==c.t&&Z(r,c.t=g),c.a=Ae(o,b,c.a),_!==c.o&&Z(l,c.o=_),c.i=Ae(s,q,c.i),z!==c.n&&Z(d,c.n=z),c.s=Ae(a,E,c.s),R!==c.h&&Z(f,c.h=R),c},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),n})()};ft(["click"]);var Br=C("<div class=chesstree>"),Fr=C("<div class=comment>"),Vr=C("<div class=lines>"),Ur=C("<div class=line>"),Zr=C("<span class=index>"),Gr=C("<div>"),Xr=C("<span class=comment>");class _e{constructor(){S(this,"_paths");this._paths=A([],{equals:!1})}static set_for_saving(t){let n=new _e;return n.paths=t,n}get paths(){return this._paths[0]().slice(0)}set paths(t){this._paths[1](t)}get clone(){let t=new _e;return t.paths=this.paths.slice(0),t}get_for_saving(){return this.paths}merge_dup(t){t.paths.forEach(n=>ui(()=>this.add_path(n)))}replace_all(t){this.paths=t.paths.slice(0)}add_path(t){let n=this.paths;n.find(i=>i.join("")===t.join(""))||(n.push(t),this.paths=n)}remove_path(t){this.paths=this.paths.filter(n=>n.join("")!==t.join(""))}clear(){this.paths.length>0&&(this.paths=[])}}const Ie=class Ie{constructor(t,n){S(this,"_tree");S(this,"_cursor_path");S(this,"_hidden_paths");S(this,"_revealed_paths");S(this,"_failed_paths");S(this,"_solved_paths");S(this,"reveal_hidden_paths",()=>{ie(()=>{this.hidden_paths.forEach(t=>{this._revealed_paths.add_path(t)}),this._hidden_paths.clear()})});S(this,"reveal_from_mainline",()=>{var i,r;if(!this.tree)return!1;const n=(((r=(i=this.tree)==null?void 0:i._traverse_path(this.cursor_path))==null?void 0:r.children)??this.tree.root)[0];if(n)return ie(()=>{this._hidden_paths.remove_path(n.data.path),n.children.forEach(o=>this._hidden_paths.add_path(o.data.path)),this.cursor_path=n.data.path}),n.data.uci});S(this,"reveal_one_random",()=>{var i,r;if(!this.tree)return!1;let t=((r=(i=this.tree)==null?void 0:i._traverse_path(this.cursor_path))==null?void 0:r.children)??this.tree.root;const n=Jr(t);if(n)return ie(()=>{this._hidden_paths.remove_path(n.data.path),n.children.forEach(o=>this._hidden_paths.add_path(o.data.path)),this.cursor_path=n.data.path}),n.data.uci});S(this,"try_next_uci_fail",t=>{var o,l,s;if(!this.tree)return!1;const n=(o=this.tree)==null?void 0:o._traverse_path(this.cursor_path),i=((s=(l=this.tree)==null?void 0:l._traverse_path(this.cursor_path))==null?void 0:s.children)??this.tree.root,r=i.find(d=>d.data.uci===t)??i.find(d=>eo(d.data)===t);if(r){if(this.failed_paths_expanded.find(a=>a.join("")===r.data.path.join(""))){setTimeout(()=>{this.cursor_path=this.cursor_path},100);return}return ie(()=>{this._hidden_paths.remove_path(r.data.path),r.children.forEach(a=>this._hidden_paths.add_path(a.data.path)),this._solved_paths.add_path(r.data.path),this.cursor_path=r.data.path}),!0}else{if(this.is_revealed){setTimeout(()=>{this.cursor_path=this.cursor_path},100);return}return this.add_uci(t),n?this._failed_paths.add_path([...n.data.path,t]):this._failed_paths.add_path([t]),setTimeout(()=>{this.on_wheel(-1)},100),!1}});S(this,"on_wheel",t=>{var i;let n=this.cursor_path;if(t<0)n.length>0&&this.try_set_cursor_path(n.slice(0,-1));else{let r=this.tree;if(r){let o;n.length===0?o=r.root:o=(i=r._traverse_path(n))==null?void 0:i.children;let l=o==null?void 0:o.map(s=>s.data.path).find(s=>{var d;return!((d=this.hidden_paths)!=null&&d.some(a=>s.join("").startsWith(a.join(""))))});l&&this.try_set_cursor_path(l)}}});this.initial_fen=t,this._cursor_path=A([],{equals:!1}),this._tree=A(n),this._hidden_paths=new _e,this._revealed_paths=new _e,this._failed_paths=new _e,this._solved_paths=new _e}get hidden_paths(){return this._hidden_paths.paths}get revealed_paths(){return this._revealed_paths.paths}get failed_paths(){return this._failed_paths.paths}get solved_paths(){return this._solved_paths}get failed_paths_expanded(){return this._failed_paths.paths}get solved_paths_expanded(){return this._solved_paths.paths}get revealed_paths_expanded(){return this._revealed_paths.paths}get initial_color(){var t;return(t=this.tree)==null?void 0:t.initial_color}get cursor_path(){return this._cursor_path[0]()}get tree(){return this._tree[0]()}set cursor_path(t){this._cursor_path[1](t)}set tree(t){this._tree[1](t)}get fen_last_move(){let t=this.tree;if(t){let n=t.get_at(this.cursor_path);if(!n)return;let i=n.after_fen,r=n.uci;return[i,r]}}try_set_cursor_path(t){return this.hidden_paths.find(i=>t.join("").startsWith(i.join("")))?!1:(this.cursor_path=t,!0)}get is_revealed(){var r,o;let t=this.revealed_paths_expanded.pop(),n=this.solved_paths_expanded.pop();return this.hidden_paths.length===0||t?!0:n?((o=(r=this.tree)==null?void 0:r.get_children(n))==null?void 0:o.length)===0:!1}add_uci(t){let n=this.tree,i=this.cursor_path;return n?n.append_uci(t,i):n=di.make(this.initial_fen,[t]),i=[...i,t],ie(()=>{this.tree=n,this.cursor_path=i}),i}get is_next_hidden_cursor_path(){var i;let t=this.cursor_path,n=this.tree;if(n){let r;return t.length===0?r=n.root:r=(i=n._traverse_path(t))==null?void 0:i.children,!!(r!=null&&r.map(o=>o.data.path).find(o=>{var l;return(l=this.hidden_paths)==null?void 0:l.some(s=>o.join("").startsWith(s.join("")))}))}}get can_navigate_next(){var i;let t=this.cursor_path,n=this.tree;if(n){let r;return t.length===0?r=n.root:r=(i=n._traverse_path(t))==null?void 0:i.children,(r==null?void 0:r.map(l=>l.data.path).find(l=>{var s;return!((s=this.hidden_paths)!=null&&s.some(d=>l.join("").startsWith(d.join(""))))}))!==void 0}return!1}get can_navigate_prev(){return this.cursor_path.length>0}navigate_last(){var i,r;let t=this.cursor_path,n=this.tree;if(n){let o;t.length===0?o=n.root:o=(i=n._traverse_path(t))==null?void 0:i.children;let l=o==null?void 0:o.map(s=>s.data.path).find(s=>{var d;return!((d=this.hidden_paths)!=null&&d.some(a=>s.join("").startsWith(a.join(""))))});if(l){let s=n._traverse_path(l);for(;s.children.length>0&&!((r=this.hidden_paths)!=null&&r.some(d=>s.children[0].data.path.join("").startsWith(d.join(""))));)s=s.children[0];l=s.data.path,this.try_set_cursor_path(l)}}}navigate_next(){var i;let t=this.cursor_path,n=this.tree;if(n){let r;t.length===0?r=n.root:r=(i=n._traverse_path(t))==null?void 0:i.children;let o=r==null?void 0:r.map(l=>l.data.path).find(l=>{var s;return!((s=this.hidden_paths)!=null&&s.some(d=>l.join("").startsWith(d.join(""))))});o&&this.try_set_cursor_path(o)}}navigate_prev(){this.try_set_cursor_path(this.cursor_path.slice(0,-1))}navigate_first(){this.try_set_cursor_path(this.cursor_path.slice(0,1))}};S(Ie,"make",(t,n=(t==null?void 0:t.before_fen)??_t)=>new Ie(n,t));let ut=Ie;const Yr=e=>{let t;return N(()=>{let n=e.lala.cursor_path,i=t.parentElement;if(!i)return;const r=t.querySelector(".on_path_end");if(!r){i.scrollTop=n.length>0?99999:0;return}let o=r.offsetTop-i.offsetHeight/2+r.offsetHeight;i.scrollTo({behavior:"smooth",top:o})}),(()=>{var n=Br();return pt(i=>t=i,n),m(n,w(D,{get when(){return e.lala.tree},get fallback(){return[]},children:i=>[w(D,{get when(){return y(()=>!!e.lala.is_revealed)()&&i().comments},children:r=>(()=>{var o=Fr();return m(o,r),o})()}),w(Oe,{get show_comments(){return e.lala.is_revealed},on_set_path:r=>e.lala.try_set_cursor_path(r),get cursor_path(){return e.lala.cursor_path},get hidden_paths(){return e.lala.hidden_paths},get revealed_paths(){return e.lala.revealed_paths},get solved_paths(){return e.lala.solved_paths_expanded},get failed_paths(){return e.lala.failed_paths_expanded},get lines(){return i().root},show_index:!0})]})),n})()},Oe=e=>w(dn,{get children(){return[w(Me,{get when(){return e.lines.length===1},get children(){return[w(Qr,De({get data(){return e.lines[0].data}},e)),w(Oe,De(e,{get lines(){return e.lines[0].children},show_index:!1}))]}}),w(Me,{get when(){return e.lines.length>1},get children(){return[w(Oe,De(e,{get lines(){return e.lines.slice(0,1)}})),(()=>{var t=Vr();return m(t,w(cn,{get each(){return e.lines.slice(1)},children:n=>(()=>{var i=Ur();return m(i,w(Oe,De(e,{lines:[n],show_index:!0}))),i})()})),t})()]}})]}}),Qr=e=>{let t=y(()=>{let h=`${Math.ceil(e.data.ply/2)}.`;return e.data.ply%2===0&&(h+=".."),h}),n=y(()=>e.cursor_path.join("").startsWith(e.data.path.join(""))),i=y(()=>e.cursor_path.join("")===e.data.path.join("")),r=y(()=>e.data.path.join("")),o=y(()=>e.hidden_paths.find(h=>h.join("")===r())),l=y(()=>e.hidden_paths.find(h=>r().startsWith(h.join("")))),s=y(()=>e.revealed_paths.find(h=>h.join("")===r())),d=y(()=>e.revealed_paths.find(h=>r().startsWith(h.join("")))),a=y(()=>e.failed_paths.find(h=>h.join("")===r())),f=y(()=>e.solved_paths.find(h=>h.join("")===r())),c=y(()=>["move",i()?"on_path_end":n()?"on_path":"",o()?"on_hidden_path_start":l()?"on_hidden_path":"",s()?"on_revealed_path_start":d()?"on_revealed_path":"",a()?"on_failed_path":"",f()?"on_solved_path":"",e.collapsed?"collapsed":""].join(" "));return[(()=>{var h=Gr();return h.$$click=()=>e.on_set_path(e.data.path),m(h,w(D,{get when(){return e.show_index||e.data.ply&1},get children(){var g=Zr();return m(g,t),g}}),null),m(h,()=>e.data.san,null),pe(()=>Z(h,c())),h})(),w(D,{get when(){return e.show_comments&&e.data.comments},children:h=>(()=>{var g=Xr();return m(g,h),g})()})]};function Jr(e){let t=e.length*(e.length+1)/2,n=Math.floor(Math.random()*t)+1,i=0;for(let r=0;r<e.length;r++)if(i+=e.length-r,n<=i)return e[r]}const eo=e=>{let t=e.uci.slice(0,2),n=e.uci[3];if(e.san==="O-O")return t+"g"+n;if(e.san==="O-O-O")return t+"c"+n};ft(["click"]);const to=e=>ot(e).unwrap().turn,Be=class Be{constructor(){S(this,"_uci_pending_promotion");S(this,"_add_uci");S(this,"_promotion");S(this,"_position");S(this,"m_fen");S(this,"m_dests");S(this,"m_color");S(this,"_last_move");S(this,"_on_wheel");S(this,"set_on_wheel",t=>{this._on_wheel[1](t)});S(this,"on_set_fen_uci",(t,n)=>{ie(()=>{this.add_uci=void 0,this.last_move=n,this.position=Ft.fromSetup(ot(t).unwrap()).unwrap()})});S(this,"reset_move_after",()=>{this.position=this.position});S(this,"on_move_after",(t,n)=>{let i=this.fen,r=this.last_move,o=this.position.board.get(fi(t)),l=t+n;if(o.role==="pawn"&&(n[1]==="8"&&this.turnColor==="white"||n[1]==="1"&&this.turnColor==="black")){this.uci_pending_promotion=[t,n,i,r];return}this.do_play_uci(l)});S(this,"on_promotion_end",t=>{let n=this.uci_pending_promotion;if(this.uci_pending_promotion=void 0,n){let[i,r,o,l]=n;t?this.do_play_uci(i+r+t,[r,t]):this.on_set_fen_uci(o,l)}});this._on_wheel=A(void 0,{equals:!1}),this._last_move=A(void 0,{equals:!1}),this._add_uci=A(void 0,{equals:!1}),this._promotion=A(void 0,{equals:!1}),this._uci_pending_promotion=A(void 0,{equals:!1}),this._position=A(Ft.fromSetup(ot(_t).unwrap()).unwrap(),{equals:!1}),this.m_dests=y(()=>bi(this.position)),this.m_fen=y(()=>hi(this.position.toSetup())),this.m_color=y(()=>this.position.turn)}get position(){return this._position[0]()}set position(t){this._position[1](t)}get turnColor(){return this.m_color()}get add_uci(){return this._add_uci[0]()}set add_uci(t){this._add_uci[1](t)}get last_move(){return this._last_move[0]()}set last_move(t){this._last_move[1](t)}get promotion(){return this._promotion[0]()}set promotion(t){this._promotion[1](t)}get uci_pending_promotion(){return this._uci_pending_promotion[0]()}set uci_pending_promotion(t){this._uci_pending_promotion[1](t)}get uci_pending_promotion_color_dest(){let t=this.uci_pending_promotion;if(t){let[n,i,r,o]=t;return{color:to(r),dest:i}}}get on_wheel(){return this._on_wheel[0]()}do_play_uci(t,n){ie(()=>{this.position.play(pi(t)),this.last_move=t,this.position=this.position,this.promotion=n,this.add_uci=t,console.log(n)})}get fen_uci(){let t=this.fen,n=this.last_move;return[t,n]}get fen(){return this.m_fen()}get dests(){return this.m_dests()}};S(Be,"init",()=>new Be);let ht=Be;var no=C("<span>Loading..."),io=C("<span>Failed loading PGNs.."),ro=C("<span>#"),oo=C("<span> Puzzles"),lo=C("<h3>Puzzle Completed!"),ln=C("<h4>"),so=C("<span class=success>solved +1"),ao=C("<span class=success>failed +1"),co=C("<span class=success>skipped +1"),uo=C("<span class=link>Continue with next puzzle."),ho=C('<div class=home><div class=board-wrap></div><div class=replay-wrap><div class=replay><div class=replay-header><span><a>lichess</a></span></div><div class=replay-v></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=replay-tools></div></div></div><div class=side><div class=side-header><span class=title>Set: </span><span class=run>Run: #</span><span class=time>Total Time: </span></div><div class=side-info><span class=event>Event: </span><div class=players><div class="color-icon white"></div><div class="color-icon black"></div></div></div><div class=side-tools><div class=jump-toggle><input type=checkbox id=jump-next><label for=jump-next>Jump to next puzzle immediately</label></div><div class=show-dropdown><label for=show-only>Show Only</label><select id=show-only><option value="">Normal Run</option><option value=solved>Solved Puzzles</option><option value=unseen>Unseen Puzzles</option><option value=failed>Failed Puzzles</option><option value=skipped>Skipped Puzzles</option></select></div></div></div><div class=under><div class=side-list>'),sn=C("<span> There are no <!> Puzzles "),fo=C("<span> You've finished a Run. "),po=C("<div class=end-stats><div class=out><span class=solved>Solved: <!>/</span><span class=failed>Failed: <!>/</span><span class=skipped>Skipped: <!>/<!> </span></div><span>Time Spent: <!> "),_o=C("<button>Start a New Run"),go=C("<div class=info>"),vo=C("<button>Go back to Run"),mo=C("<div class=info><h3><span class=turn></span> to play</h3><span>Find the best move for "),bo=C("<span>View Solution"),wo=C("<span>");const yo=e=>(e=e.replace(" ","_"),`https://lichess.org/analysis/${e}`),Po=()=>{let e=Ne.active_user??Ne.anonymous_user;const[t]=Vt(()=>lt.get_or_create_active_run_for_user(e)),n=y(()=>{var r;return(r=t())==null?void 0:r.set_id}),[i]=Vt(n,r=>mi.get_study_by_id(r));return w(D,{get when(){return i.loading},get fallback(){return w(D,{get when(){return i.error},get fallback(){return w(D,{get when(){return y(()=>!!i())()&&!!t()},get children(){return w($o,{get pgn(){return i()},get run(){return t()}})}})},get children(){return io()}})},get children(){return no()}})},$o=e=>{let t=Ne.active_user??Ne.anonymous_user;const[n,i]=A(e.run,{equals:!1}),r=()=>e.pgn,[o,l]=A(!0),s=()=>r().hide_first,d=()=>r().random_line;let a;const[f,c]=A(0),[h,g]=A(Zt.navigate_filter);Zt.navigate_filter=void 0;const b=y(()=>[...Array(e.pgn.chapters.length).keys()]),_=()=>n().solved,q=()=>n().failed,z=()=>n().skipped,E=y(()=>{let u=[..._(),...q(),...z()];return b().filter(v=>!u.includes(v))}),R=y(()=>{let u=h();if(u==="failed")return q();if(u==="skipped")return z();if(u==="solved")return _();if(u==="unseen")return E()}),Y=y(()=>h()===void 0),B=_i(),[le,be]=A(!1),[k,G]=A(!1),[K,H]=A(!1);let se=R();const[te,we]=A(se?se[0]:E()[0]),ye=y(()=>e.pgn.chapters[te()??0]),Kn=()=>ye().site??yo(ye().pgn.tree.before_fen),I=new ht,$=y(Q(ye,u=>{let v=ut.make(u.pgn.tree.clone);return s()?v.tree.root.map(x=>x.data.path).forEach(x=>v._hidden_paths.add_path(x)):v.tree.root[0].children.map(x=>x.data.path).forEach(x=>v._hidden_paths.add_path(x)),I.on_set_fen_uci(v.initial_fen),H(!1),c(0),setTimeout(()=>{s()?v.cursor_path=[]:v.cursor_path=v.tree.root[0].data.path,H(!0),clearInterval(a),a=setInterval(()=>c(f()+1e3),1e3)},600),v}));N(Q(Y,u=>{c(0),clearInterval(a),u&&(a=setInterval(()=>c(f()+1e3),1e3))})),N(Q(()=>I.add_uci,u=>{if(!u)return;$().try_next_uci_fail(u)&&(G(!0),setTimeout(()=>{d()?$().reveal_one_random():$().reveal_from_mainline(),G(!1)},600))})),N(Q(()=>$().fen_last_move,u=>{if(u){let[v,x]=u;I.on_set_fen_uci(v,x)}else I.on_set_fen_uci($().initial_fen)}));const Ct=()=>{l(!1);let u=te();if(u===void 0)return;let v=R();v?u=v[v.indexOf(u)+1]:u=u+1,u>=e.pgn.chapters.length?we(void 0):we(u)},Hn=()=>{if(!K())return!1;$().reveal_hidden_paths()};N(Q(()=>$().is_revealed,u=>{u&&$().reveal_hidden_paths()}));let ae=y(Q(()=>$().is_revealed,u=>{var v,x;if(!Y())return"not_in_run";if(u){let ce=$().failed_paths_expanded.length>0,de=$().revealed_paths_expanded.length>0;if(ce)return"failed";let ue=$().solved_paths_expanded.pop();return ue&&((x=(v=$().tree)==null?void 0:v.get_children(ue))==null?void 0:x.length)===0?"solved":de?"revealed":"solved"}return"thinking"}));N(()=>{console.log(ae())}),N(()=>{ae()==="solved"&&le()&&(G(!0),setTimeout(()=>{Ct(),G(!1)},600))}),N(Q(ae,u=>{if(u==="not_in_run"||u==="thinking")return;let v=te(),x=n();u==="failed"?x.failed.push(v):u==="revealed"?x.skipped.push(v):u==="solved"&&x.solved.push(v),x.elapsed_ms+=f(),lt._save_run(x),clearInterval(a),i(x)})),N(Q(()=>{var u;return(u=$().tree)==null?void 0:u.get_at($().cursor_path)},u=>{u&&B.move(u)})),N(Q(()=>I.on_wheel,u=>{k()||u&&$().on_wheel(u)}));const Pt=u=>{const v=u.target;v.tagName!=="PIECE"&&v.tagName!=="SQUARE"&&v.tagName!=="CG-BOARD"||(u.preventDefault(),I.set_on_wheel(Math.sign(u.deltaY)))};let Fe;an(()=>{Fe.addEventListener("wheel",Pt,{passive:!1})}),gi(()=>{Fe.removeEventListener("wheel",Pt)});const xt=y(()=>{let u=$().initial_color;return s()?u:Ut(u)}),In=y(()=>{let u=$().initial_color??"white";return s()?u:Ut(u)}),Bn=u=>{let v=y(()=>z().includes(u)),x=y(()=>_().includes(u)),ce=y(()=>q().includes(u)),de=y(()=>u===te());const ue=y(()=>{var ke;return(ke=R())==null?void 0:ke.includes(u)});let Ue=y(()=>de()?"current":v()?"skipped":x()?"solved":ce()?"failed":"");return[ue()?"filtered":"",Ue()].join(" ")},$e=u=>{g(u===""?void 0:u);let v=R();we(v?v[0]:E()[0])},Fn=u=>{let v=z().includes(u),x=_().includes(u),ce=q().includes(u);g(v?"skipped":x||ce?"solved":"unseen")},Ve=()=>{let u=h();return u==="failed"?"Failed":u==="skipped"?"Skipped":u==="solved"?"Solved":u==="unseen"?"Unseen":"All"};let[Vn,Mt]=A(!1);const Un=async()=>{Mt(!0);let u=await lt.start_new_run(t);ie(()=>{Mt(!1),i(u),we(0)})};return(()=>{var u=ho(),v=u.firstChild,x=v.nextSibling,ce=x.firstChild,de=ce.firstChild,ue=de.firstChild,Ue=ue.firstChild,ke=de.nextSibling,zt=ke.nextSibling,Ze=zt.firstChild,Ge=Ze.nextSibling,Xe=Ge.nextSibling,qt=Xe.nextSibling,Zn=zt.nextSibling,Et=x.nextSibling,jt=Et.firstChild,Ye=jt.firstChild;Ye.firstChild;var Qe=Ye.nextSibling;Qe.firstChild;var At=Qe.nextSibling;At.firstChild;var Dt=jt.nextSibling,Je=Dt.firstChild;Je.firstChild;var Gn=Je.nextSibling,Tt=Gn.firstChild,Xn=Tt.nextSibling,Yn=Dt.nextSibling,Ot=Yn.firstChild,Nt=Ot.firstChild,Qn=Ot.nextSibling,Jn=Qn.firstChild,Wt=Jn.nextSibling,ei=Et.nextSibling,ti=ei.firstChild;return pt(p=>Fe=p,u),m(v,w(Hr,{get resizable(){return o()},get orientation(){return In()},get movable(){return y(()=>te()!==void 0&&!k()&&!$().is_revealed)()&&$().is_next_hidden_cursor_path},get endPendingPromotion(){return I.on_promotion_end},get pendingPromotion(){return I.uci_pending_promotion_color_dest},get doPromotion(){return I.promotion},get onMoveAfter(){return I.on_move_after},get fen_uci(){return I.fen_uci},get color(){return I.turnColor},get dests(){return I.dests}})),m(de,w(D,{get when(){return te()!==void 0},get fallback(){return(()=>{var p=sn(),P=p.firstChild,F=P.nextSibling;return F.nextSibling,m(p,Ve,F),p})()},get children(){return[(()=>{var p=ro();return p.firstChild,m(p,()=>te()+1,null),p})(),(()=>{var p=oo(),P=p.firstChild;return m(p,Ve,P),p})()]}}),ue),m(ke,w(Yr,{get lala(){return $()}})),Ze.$$click=()=>$().navigate_first(),Ge.$$click=()=>$().navigate_prev(),Xe.$$click=()=>$().navigate_next(),qt.$$click=()=>$().navigate_last(),m(Zn,w(D,{get when(){return te()!==void 0},get fallback(){return(()=>{var p=go();return m(p,w(D,{get when(){return Y()},get fallback(){return[(()=>{var P=sn(),F=P.firstChild,O=F.nextSibling;return O.nextSibling,m(P,Ve,O),P})(),(()=>{var P=vo();return P.$$click=()=>$e(""),P})()]},get children(){return[fo(),(()=>{var P=po(),F=P.firstChild,O=F.firstChild,he=O.firstChild,Se=he.nextSibling;Se.nextSibling;var Ce=O.nextSibling,ni=Ce.firstChild,Lt=ni.nextSibling;Lt.nextSibling;var je=Ce.nextSibling,ii=je.firstChild,Rt=ii.nextSibling,ri=Rt.nextSibling,Kt=ri.nextSibling;Kt.nextSibling;var Ht=F.nextSibling,oi=Ht.firstChild,It=oi.nextSibling;return It.nextSibling,O.$$click=()=>$e("solved"),m(O,()=>n().solved.length,Se),m(O,()=>et(n()),null),Ce.$$click=()=>$e("failed"),m(Ce,()=>n().failed.length,Lt),m(Ce,()=>et(n()),null),je.$$click=()=>$e("skipped"),m(je,()=>n().skipped.length,Rt),m(je,()=>et(n()),Kt),m(Ht,()=>Te(n().elapsed_ms),It),P})(),w(D,{get when(){return!Vn()},get children(){var P=_o();return P.$$click=()=>Un(),P}})]}})),p})()},get children(){return w(D,{get when(){return $().is_revealed},get fallback(){return[(()=>{var p=mo(),P=p.firstChild,F=P.firstChild,O=P.nextSibling;return O.firstChild,m(F,xt),m(O,xt,null),m(p,w(D,{get when(){return Y()},get children(){var he=ln();return m(he,()=>Te(f(),!1)),he}}),null),p})(),(()=>{var p=bo();return p.$$click=()=>Hn(),pe(()=>Z(p,"solution"+(K()?"":" fade-out"))),p})()]},get children(){return[lo(),w(D,{get when(){return Y()},get children(){var p=ln();return m(p,()=>Te(f(),!1)),p}}),w(dn,{get children(){return[w(Me,{get when(){return ae()==="solved"},get children(){return so()}}),w(Me,{get when(){return ae()==="failed"},get children(){return ao()}}),w(Me,{get when(){return ae()==="revealed"},get children(){return co()}})]}}),w(D,{get when(){return!(le()&&ae()==="solved")},get children(){var p=uo();return p.$$click=()=>Ct(),p}})]}})}})),m(Ye,()=>r().name,null),m(Qe,()=>n().no,null),m(At,()=>Te(n().elapsed_ms),null),m(Je,()=>ye().pgn.event,null),m(Tt,()=>ye().pgn.white),m(Xn,()=>ye().pgn.black),Nt.addEventListener("change",p=>be(p.currentTarget.checked)),Wt.addEventListener("change",p=>$e(p.currentTarget.value)),m(ti,w(cn,{get each(){return b()},children:p=>(()=>{var P=wo();return P.$$click=()=>{Fn(p),we(p)},m(P,p+1),pe(()=>Z(P,Bn(p))),P})()})),pe(p=>{var P=Kn(),F="fbt first"+(!k()&&$().can_navigate_prev?"":" disabled"),O="fbt prev"+(!k()&&$().can_navigate_prev?"":" disabled"),he="fbt next"+(!k()&&$().can_navigate_next?"":" disabled"),Se="fbt last"+(!k()&&$().can_navigate_next?"":" disabled");return P!==p.e&&vi(Ue,"href",p.e=P),F!==p.t&&Z(Ze,p.t=F),O!==p.a&&Z(Ge,p.a=O),he!==p.o&&Z(Xe,p.o=he),Se!==p.i&&Z(qt,p.i=Se),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),pe(()=>Nt.checked=le()),pe(()=>Wt.value=h()===void 0?"":h()),u})()};ft(["click"]);export{Po as default};
